

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/panda.png">
  <link rel="icon" href="/img/panda.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#55967e">
  <meta name="description" content="æ¬¢è¿ä¹˜åå…«æ¥¼çš„äºŒè·¯å…¬äº¤è½¦">
  <meta name="author" content="Rains.Lee">
  <meta name="keywords" content="Java">
  
  <title>Exectuoræ¡†æ¶è§£æ - ä¸€é¢—èƒ¡æ¨æ ‘</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"eripe.me","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":"UA-198559201-1","gtag":"G-19MVRDT9NM","tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"3MrDNVWQz1aBbREDmtPT7DuN-MdYXbMMI","app_key":"34YIO0Yk922Dzi79zUJidSkl","server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/rss2.xml" title="ä¸€é¢—èƒ¡æ¨æ ‘" type="application/rss+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>RainsÂ·Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/home.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Exectuoræ¡†æ¶è§£æ">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-06-14 20:42" pubdate>
        2021å¹´6æœˆ14æ—¥ æ™šä¸Š
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      3.7k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      42
       åˆ†é’Ÿ
    </span>
  

  
  
    
      <!-- LeanCloud ç»Ÿè®¡æ–‡ç« PV -->
      <span id="leancloud-page-views-container" class="post-meta" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="leancloud-page-views"></span> æ¬¡
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Exectuoræ¡†æ¶è§£æ</h1>
            
            <div class="markdown-body">
              <h2 id="1-Executoræ¥å£"><a href="#1-Executoræ¥å£" class="headerlink" title="1. Executoræ¥å£"></a>1. Executoræ¥å£</h2><p>åœ¨JUCåŒ…ä¸­ï¼Œè¿˜æä¾›äº†Executoræ¡†æ¶ç”¨æ¥å®ç°çº¿ç¨‹æ± ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„çº¿ç¨‹æ± éƒ½æ˜¯ä»Executoræ´¾ç”Ÿè€Œæ¥ã€‚æˆ‘ä»¬å¯ä»¥çœ‹çœ‹æ•´ä¸ªExecutoræ¡†æ¶çš„ç»§æ‰¿ç»“æ„ï¼š</p>
<p><img src="images/executor-framework.png" srcset="/img/loading.gif" lazyload alt="executor-framework"></p>
<p>é‚£ä¹ˆåœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ­¥åº”è¯¥éœ€è¦äº†è§£å®ƒçš„æ ¸å¿ƒæ¥å£<code>Executor</code>ã€‚è¿™ä¸ªæ¥å£çš„ä½œç”¨åœ¨å®ƒçš„æ³¨é‡Šä¸­è¯´çš„å¾ˆæ¸…æ¥šï¼š</p>
<blockquote>
<p>An object that executes submitted Runnable tasks. This interface provides a way of decoupling task submission from the mechanics of how each task will be run, including details of thread use, scheduling, etc. An Executor is normally used instead of explicitly creating threads. For example, rather than invoking new Thread(new(RunnableTask())).start() for each of a set of tasks</p>
</blockquote>
<p>è¿™ä¸ªæ¥å£çš„ä½œç”¨å°±æ˜¯è®©ç”¨æˆ·ä¸“æ³¨äºçº¿ç¨‹çš„ä»»åŠ¡ï¼Œè‡³äºçº¿ç¨‹æ€ä¹ˆè°ƒç”¨çš„ï¼Œå¦‚ä½•è¿è¡Œçš„ï¼Œç”¨æˆ·å¹¶ä¸éœ€è¦å…³å¿ƒã€‚å…·ä½“çš„å®ç°ç±»å¯ä»¥ä»»æ„å®ç°çº¿ç¨‹ä¹‹é—´çš„åä½œã€‚å”¯ä¸€çš„æŠ½è±¡æ–¹æ³•å°±æ˜¯<code>execute</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">Executor</span> </span>&#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Executes the given command at some time in the future.  The command</span><br><span class="hljs-comment">     * may execute in a new thread, in a pooled thread, or in the calling</span><br><span class="hljs-comment">     * thread, at the discretion of the &#123;<span class="hljs-doctag">@code</span> Executor&#125; implementation.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> command the runnable task</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> RejectedExecutionException if this task cannot be</span><br><span class="hljs-comment">     * accepted for execution</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> NullPointerException if command is null</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(Runnable command)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h2 id="2-ExecutorServiceæ¥å£"><a href="#2-ExecutorServiceæ¥å£" class="headerlink" title="2. ExecutorServiceæ¥å£"></a>2. ExecutorServiceæ¥å£</h2><p>é‚£ä¹ˆå¯¹äºExecutorçš„å¢å¼ºç±»æ¥å£<code>ExecutorService</code>å‘¢ï¼Ÿæˆ‘ä»¬çœ‹çœ‹å®ƒçš„æ³¨é‡Šï¼š</p>
<blockquote>
<p>An Executor that provides methods to manage termination and methods that can produce a Future for tracking progress of one or more asynchronous tasks.<br>An ExecutorService can be shut down, which will cause it to reject new tasks. Two different methods are provided for shutting down an ExecutorService. The shutdown method will allow previously submitted tasks to execute before terminating, while the shutdownNow method prevents waiting tasks from starting and attempts to stop currently executing tasks. Upon termination, an executor has no tasks actively executing, no tasks awaiting execution, and no new tasks can be submitted. An unused ExecutorService should be shut down to allow reclamation of its resources.</p>
</blockquote>
<p>ä¸Šè¿°å¤§è‡´å°±æ˜¯ExecutorServiceä½œä¸ºä¸€ä¸ªExecutorï¼Œå®ƒæä¾›ä¸€äº›æ–¹æ³•ç”¨æ¥ç»ˆæ­¢å½“å‰å¯¹è±¡æä¾›æœåŠ¡ä»¥åŠä¸€äº›æ–¹æ³•ç”¨äºäº§ç”Ÿä¸€ä¸ª<strong>Future</strong>è¡¨ç¤ºå¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœã€‚å¹¶ä¸”ä¸€ä¸ªExecutorServiceå¯ä»¥è¢«å…³é—­ï¼Œä½†æ˜¯è¿™å¯èƒ½ä¼šå¯¼è‡´æ–°ä»»åŠ¡è¢«è¿«ç»ˆæ­¢ã€‚å®ƒæä¾›äº†ä¸¤ç±»æ–¹æ³•ç”¨æ¥ç»ˆæ­¢è‡ªèº«ã€‚</p>
<ul>
<li>ç¬¬ä¸€ç±»æ˜¯<code>shutdown</code>æ–¹æ³•ï¼Œè¿™ç±»æ–¹æ³•ä¼šå°†åœæ­¢ä¹‹å‰å·²ç»æäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</li>
<li>ç¬¬äºŒç±»æ˜¯<code>shutdownNow</code>æ–¹æ³•ï¼Œè¿™ç±»æ–¹æ³•ä¼šå°†å·²ç»æäº¤ä½†æœªæ‰§è¡Œçš„ä»»åŠ¡ç›´æ¥ç»ˆæ­¢ï¼Œå¹¶ä¸”å°è¯•å¯¹ç»ˆæ­¢æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ã€‚</li>
</ul>
<p>ç»ˆæ­¢åExecutorServiceä¸ä¼šå­˜åœ¨è¿˜åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•æäº¤ä»»åŠ¡ã€‚å½“æˆ‘ä»¬ä¸å†éœ€è¦ExecutorServiceæ—¶ï¼Œå°±åº”å°†å…¶å…³é—­ï¼Œé¿å…èµ„æºæµªè´¹ã€‚</p>
<p>å¯¹ExecutorServiceæœ‰äº†ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†åï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒæä¾›çš„ä¸€äº›æ ¸å¿ƒæ–¹æ³•ï¼š</p>
<p><img src="images/ExecutorService.png" srcset="/img/loading.gif" lazyload alt="ExecutorService"></p>
<p>å…¶å®è¿˜æœ‰ä¸€ç‚¹å¯ä»¥å€¼å¾—å…³æ³¨ï¼Œå°±æ˜¯ä¸Šè¿°æåˆ°çš„<code>Future</code>ã€‚è¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªé¡¶çº§æ¥å£ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯ç”¨æ¥ä¿å­˜å¼‚æ­¥çº¿ç¨‹æ‰§è¡Œçš„ç»“æœã€‚åç»­å†è¯¦ç»†åˆ†æã€‚</p>
<h3 id="2-1-AbstractExecuteService"><a href="#2-1-AbstractExecuteService" class="headerlink" title="2.1 AbstractExecuteService"></a>2.1 AbstractExecuteService</h3><p>å¯¹äºExecutorServiceæ¥å£ï¼ŒJUCæä¾›äº†ä¸€ä¸ªæŠ½è±¡å®ç°ç±»<code>AbstractExecutorService</code>è´Ÿè´£å®ç°äº†ä¸€äº›å¼‚æ­¥æ‰§è¡Œä»»åŠ¡æ ¸å¿ƒæ–¹æ³•çš„å®ç°ï¼ŒåŒ…æ‹¬<code>submit</code>ã€<code>invokeAll</code>ã€<code>invokeAny</code>è¿™ä¸‰ç±»ã€‚å¹¶ä¸”æä¾›äº†ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œèƒ½å¤Ÿå°†æäº¤çš„ä»»åŠ¡ï¼ˆcallableæˆ–è€…runnableï¼‰åŒ…è£…ä¸ºä¸€ä¸ª<code>FutureTask</code>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> &lt;T&gt; <span class="hljs-function">RunnableFuture&lt;T&gt; <span class="hljs-title">newTaskFor</span><span class="hljs-params">(Callable&lt;T&gt; callable)</span> </span>&#123;<br>   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FutureTask&lt;T&gt;(callable);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>æ‰€è°“çš„<code>FutureTask</code>å…¶å®æ˜¯<code>Future</code>æ¥å£çš„å®ç°ç±»ï¼Œè¿™ä¸ªæˆ‘ä»¬åç»­åœ¨åˆ†æ<code>Future</code>ä½“ç³»çš„æ—¶å€™å†è¯¦ç»†ä»‹ç»ã€‚å…¶å®æˆ‘ä»¬åº”è¯¥é‡ç‚¹å…³æ³¨æäº¤å‡½æ•°<code>submit</code>åˆ°åº•æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Future&lt;?&gt; submit(Runnable task) &#123;<br>   <span class="hljs-keyword">if</span> (task == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> NullPointerException();<br>   RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, <span class="hljs-keyword">null</span>);<br>   execute(ftask);<br>   <span class="hljs-keyword">return</span> ftask;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>ä»ä¸Šé¢å¾—çŸ¥ï¼Œ<code>submit</code>å‡½æ•°çš„é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æäº¤åçš„<code>Runnable</code>æˆ–è€…<code>callable</code>å®ç°ç±»åŒ…è£…æˆ<code>FutureTask</code>åï¼Œè¿˜æ˜¯ä¼šè°ƒç”¨é¡¶çº§æ¥å£çš„<code>execute</code>æ–¹æ³•æ¥æ‰§è¡Œä¸€ä¸ªå…·ä½“çš„ä»»åŠ¡ã€‚è¿™é‡Œè¿˜æ˜¯æ— æ³•å¾—çŸ¥çº¿ç¨‹åˆ°åº•æ˜¯å¦‚ä½•è°ƒåº¦çš„ã€‚</p>
<h3 id="2-2-ScheduledExecutorService"><a href="#2-2-ScheduledExecutorService" class="headerlink" title="2.2 ScheduledExecutorService"></a>2.2 ScheduledExecutorService</h3><p><code>ScheduledExecutorService</code>æ¥å£çš„æœ€ç”¨å…¶å®å¾ˆç®€å•ï¼Œæ­£å¦‚åœ¨å®ƒçš„æ³¨é‡Šä¸­æ‰€å†™çš„ï¼Œç”¨æ¥æ‰§è¡Œä¸€äº›å®šæ—¶ä»»åŠ¡æˆ–è€…å‘¨æœŸä»»åŠ¡ï¼š</p>
<blockquote>
<p>An ExecutorService that can schedule commands to run after a given delay, or to execute periodically.<br>The schedule methods create tasks with various delays and return a task object that can be used to cancel or check execution. The scheduleAtFixedRate and scheduleWithFixedDelay methods create and execute tasks that run periodically until cancelled.</p>
</blockquote>
<p>é‚£ä¹ˆè¯¥æ¥å£å®šä¹‰å››ä¸ªæŠ½è±¡æ–¹æ³•ç”¨æ¥æäº¤å®šæ—¶æˆ–å‘¨æœŸä»»åŠ¡ï¼š</p>
<p><img src="images/ScheduleExecutorService.png" srcset="/img/loading.gif" lazyload alt="ScheduleExecutorService"></p>
<p>æäº¤ä»»åŠ¡ååŒæ ·ä¼šè¿”å›ä¸€ä¸ª<code>Future</code>æ¥å£çš„å®ç°ç±»<code>ScheduleFuture</code>ï¼Œæ ¹æ®ä¸åŒçš„ä»»åŠ¡å®‰æ’ï¼Œ<code>ScheduleFuture</code>ä»£è¡¨çš„å«ä¹‰ä¸åŒï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹APIæ–‡æ¡£ã€‚</p>
<h2 id="3-çº¿ç¨‹æ± ThreadPoolExecutor"><a href="#3-çº¿ç¨‹æ± ThreadPoolExecutor" class="headerlink" title="3. çº¿ç¨‹æ± ThreadPoolExecutor"></a>3. çº¿ç¨‹æ± ThreadPoolExecutor</h2><p><code>ThreadPoolExecutor</code>æ˜¯ä¸€ä¸ªå…·ä½“çº¿ç¨‹æ± ç±»ï¼Œå®ƒé€šè¿‡ç»§æ‰¿<code>AbstractExecutorService</code>æ¥å®ç°æ¥å£<code>Executor</code>ã€‚è¯¥ç±»å®ç°äº†å…·ä½“è°ƒåº¦çº¿ç¨‹çš„æ–¹æ³•è´Ÿè´£å®Œæˆæäº¤çš„ä»»åŠ¡ã€‚å¹¶ä¸”é€šè¿‡ä¸€ç»„å‚æ•°å®ç°äº†å¾ˆå¼ºçš„æ‰©å±•æ€§ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>æ ¸å¿ƒçº¿ç¨‹æ•°ä¸æœ€å¤§çº¿ç¨‹æ•°</li>
<li>é¢„å…ˆå¯åŠ¨æ ¸å¿ƒçº¿ç¨‹</li>
<li>æ–°çº¿ç¨‹çš„ç”Ÿäº§æ–¹å¼</li>
<li>çº¿ç¨‹å­˜æ´»æ—¶é—´</li>
<li>é˜»å¡é˜Ÿåˆ—</li>
<li>ä»»åŠ¡çš„æ‹’ç»ç­–ç•¥</li>
<li>hookæ–¹æ³•ï¼ˆåœ¨ä»»åŠ¡æ‰§è¡Œå‰åæ·»åŠ ä»£ç†æ–¹æ³•ï¼‰</li>
<li>çº¿ç¨‹æ± çš„ç»ˆæ­¢ç­–ç•¥</li>
</ol>
<h3 id="3-1-æ ¸å¿ƒçº¿ç¨‹æ•°"><a href="#3-1-æ ¸å¿ƒçº¿ç¨‹æ•°" class="headerlink" title="3.1 æ ¸å¿ƒçº¿ç¨‹æ•°"></a>3.1 æ ¸å¿ƒçº¿ç¨‹æ•°</h3><p>å› ä¸ºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ä¼šæ ¹æ®å‚æ•°<code>corePoolSize</code>å’Œ<code>maximumPoolSize</code>çš„å¤§å°è¿›è¡ŒåŠ¨æ€è°ƒæ•´ã€‚å½“åœ¨æ–¹æ³•<code>execute(Runnable)</code>ä¸­æäº¤æ–°ä»»åŠ¡æ—¶ï¼š</p>
<ol>
<li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡<strong>å°‘äº</strong><code>corePoolSize</code>çº¿ç¨‹æ—¶ï¼Œ<strong>å³ä½¿å…¶ä»–å·¥ä½œçº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€</strong>ï¼Œä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥å¤„ç†è¯·æ±‚</li>
<li>å¦‚æœè¿è¡Œçš„çº¿ç¨‹æ•°<strong>å¤§äº</strong><code>corePoolSize</code>ä½†å°äº<code>maximumPoolSize</code>ï¼Œåˆ™<strong>ä»…åœ¨é˜Ÿåˆ—å·²æ»¡æ—¶æ‰åˆ›å»ºæ–°çº¿ç¨‹</strong>ã€‚</li>
</ol>
<p>é€šè¿‡å°†corePoolSizeå’ŒmaximumPoolSizeè®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼Œå¯ä»¥åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ã€‚ é€šè¿‡å°†maximumPoolSizeè®¾ç½®ä¸ºä¸€ä¸ªæœ¬è´¨ä¸Šä¸å—é™åˆ¶çš„å€¼ï¼ˆä¾‹å¦‚Integer.MAX_VALUEï¼‰ï¼Œå¯ä»¥å…è®¸æ± å®¹çº³ä»»æ„æ•°é‡çš„å¹¶å‘ä»»åŠ¡ã€‚é€šå¸¸ï¼Œæ ¸å¿ƒå’Œæœ€å¤§æ± å¤§å°ä»…åœ¨æ„é€ æ—¶è®¾ç½®ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨setCorePoolSizeå’ŒsetMaximumPoolSizeåŠ¨æ€æ›´æ”¹ã€‚</p>
<h3 id="3-2-é¢„å…ˆå¯åŠ¨æ ¸å¿ƒçº¿ç¨‹"><a href="#3-2-é¢„å…ˆå¯åŠ¨æ ¸å¿ƒçº¿ç¨‹" class="headerlink" title="3.2 é¢„å…ˆå¯åŠ¨æ ¸å¿ƒçº¿ç¨‹"></a>3.2 é¢„å…ˆå¯åŠ¨æ ¸å¿ƒçº¿ç¨‹</h3><p>æ‰€è°“çš„é¢„å…ˆå¯åŠ¨æ ¸å¿ƒçº¿ç¨‹æ˜¯æŒ‡ï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ¸å¿ƒçº¿ç¨‹çš„ç”Ÿäº§æ¡ä»¶æ˜¯æœ‰æ–°çš„ä»»åŠ¡æäº¤ã€‚ä½†æ˜¯æœ‰å¯èƒ½æˆ‘ä»¬åœ¨ä¸æäº¤ä»»åŠ¡çš„æƒ…å†µä¸‹ä¹Ÿæœ‰å¯åŠ¨æ ¸å¿ƒçº¿ç¨‹çš„éœ€æ±‚ã€‚ä¾‹å¦‚å‡è®¾æˆ‘ä»¬æä¾›çš„é˜»å¡é˜Ÿåˆ—éç©ºï¼Œé‚£ä¹ˆåœ¨ä¸è°ƒç”¨<code>submit</code>æäº¤æ–°ä»»åŠ¡çš„å‰æä¸‹ï¼Œéœ€è¦æ‰‹åŠ¨å¯åŠ¨æ ¸å¿ƒçº¿ç¨‹æ¥å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚</p>
<p>é‚£ä¹ˆæ‰‹åŠ¨å¯åŠ¨æ ¸å¿ƒçº¿ç¨‹çš„æ“ä½œå¯ä»¥é€šè¿‡<code>prestartCoreThread</code>æˆ–è€…<code>prestartAllCoreThreads</code><br>æ¥å®Œæˆã€‚</p>
<h3 id="3-3-çº¿ç¨‹çš„ç”Ÿäº§æ¨¡å¼"><a href="#3-3-çº¿ç¨‹çš„ç”Ÿäº§æ¨¡å¼" class="headerlink" title="3.3 çº¿ç¨‹çš„ç”Ÿäº§æ¨¡å¼"></a>3.3 çº¿ç¨‹çš„ç”Ÿäº§æ¨¡å¼</h3><p>æ‰€è°“çš„çº¿ç¨‹çš„ç”Ÿäº§æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬å­˜æ´»çš„çº¿ç¨‹ä¸è¶³ä»¥å¤„ç†æäº¤çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ç”Ÿäº§æ–°çš„çº¿ç¨‹æ¥å¤„ç†ã€‚é‚£ä¹ˆåœ¨<code>ThreadPoolExecutor</code>ä¸­ï¼Œç»´æŠ¤äº†ä¸€ä¸ªçº¿ç¨‹å·¥å‚<code>threadFactory</code>æ¥ç”Ÿäº§çº¿ç¨‹ã€‚</p>
<p>åœ¨Javaä¸­ï¼Œçº¿ç¨‹å·¥å‚æœ‰è®¸å¤šç§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="images/ThreadFactory.png" srcset="/img/loading.gif" lazyload alt="ThreadFactory"></p>
<p>å¯¹äº<code>ThreadPoolExecutor</code>æ¥è¯´ï¼Œé‡‡ç”¨çš„æ˜¯é»˜è®¤çš„çº¿ç¨‹å·¥å‚<code>DefaultThreadFactory</code>ï¼Œè¯¥çº¿ç¨‹æ± åˆ›å»ºçš„æ‰€æœ‰çº¿ç¨‹å…¨éƒ¨éƒ½å±äºåŒä¸€ThreadGroupä¸­ï¼Œå¹¶ä¸”å…·æœ‰ç›¸åŒçš„NORM_PRIORITYä¼˜å…ˆçº§å’Œéå®ˆæŠ¤ç¨‹åºçŠ¶æ€ã€‚</p>
<p>é€šè¿‡æä¾›ä¸åŒçš„ThreadFactoryï¼Œå¯ä»¥æ›´æ”¹çº¿ç¨‹çš„åç§°ï¼Œçº¿ç¨‹ç»„ï¼Œä¼˜å…ˆçº§ï¼Œå®ˆæŠ¤ç¨‹åºçŠ¶æ€ç­‰ã€‚å¦‚æœThreadFactoryåœ¨é€šè¿‡ä»newThreadè¿”å›nullè¿”å›è¦æ±‚æ—¶æœªèƒ½åˆ›å»ºçº¿ç¨‹ï¼Œæ‰§è¡Œå™¨å°†ç»§ç»­æ‰§è¡Œï¼Œä½†å¯èƒ½æ— æ³•æ‰§è¡Œ æ‰§è¡Œä»»ä½•ä»»åŠ¡ã€‚ çº¿ç¨‹åº”å…·æœ‰â€œ modifyThreadâ€ RuntimePermissionã€‚ å¦‚æœçº¿ç¨‹æ± çš„å·¥ä½œçº¿ç¨‹æˆ–å…¶ä»–çº¿ç¨‹ä¸å…·æœ‰æ­¤è®¸å¯æƒï¼Œåˆ™æœåŠ¡å¯èƒ½ä¼šé™çº§ï¼šé…ç½®æ›´æ”¹å¯èƒ½ä¸ä¼šåŠæ—¶ç”Ÿæ•ˆï¼Œå¹¶ä¸”å…³é—­æ± å¯èƒ½ä¿æŒåœ¨å¯èƒ½ç»ˆæ­¢ä½†æœªå®Œæˆçš„çŠ¶æ€ã€‚</p>
<h3 id="3-2-çº¿ç¨‹çš„å­˜æ´»æ—¶é—´"><a href="#3-2-çº¿ç¨‹çš„å­˜æ´»æ—¶é—´" class="headerlink" title="3.2 çº¿ç¨‹çš„å­˜æ´»æ—¶é—´"></a>3.2 çº¿ç¨‹çš„å­˜æ´»æ—¶é—´</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œçº¿ç¨‹çš„å­˜æ´»æ—¶é—´ä¸€èˆ¬ç”¨æ¥é™åˆ¶éæ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ã€‚</p>
<p>å¦‚æœæ± å½“å‰å…·æœ‰çš„æ ¸å¿ƒçº¿ç¨‹æ•°è¶…è¿‡corePoolSizeï¼Œåˆ™å¤šä½™çš„çº¿ç¨‹å¦‚æœåœ¨keepAliveTimeçš„æ—¶é•¿å†…éƒ½æ²¡æœ‰å¤„ç†ä»»åŠ¡ï¼Œé‚£ä¹ˆå¤šä½™çš„çº¿ç¨‹å°†ä¼šè¢«å…³é—­ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>setKeepAliveTime(longï¼ŒTimeUnit)</code>æ–¹æ³•åŠ¨æ€æ›´æ”¹æ­¤å‚æ•°ã€‚ ä½¿ç”¨<code>Long.MAX_VALUE TimeUnit.NANOSECONDS</code>å¯ä»¥æœ‰ä½¿ç©ºé—²çº¿ç¨‹æ°¸è¿œä¸ä¼šåœ¨çº¿ç¨‹æ± å…³é—­ä¹‹å‰ç»ˆæ­¢ã€‚</p>
<p>å¯¹äºçº¿ç¨‹çš„å­˜æ´»æ—¶é—´ï¼Œæœ‰ä¸€ç‚¹éœ€è¦æˆ‘ä»¬æ³¨æ„ï¼š<strong>åªè¦keepAliveTimeå€¼ä¸ä¸ºé›¶ï¼Œè°ƒç”¨æ–¹æ³•<code>allowCoreThreadTimeOut(boolean)</code>å¯ç”¨äºå°†æ­¤è¶…æ—¶ç­–ç•¥åº”ç”¨äºæ ¸å¿ƒçº¿ç¨‹</strong></p>
<h3 id="3-3-é˜»å¡é˜Ÿåˆ—"><a href="#3-3-é˜»å¡é˜Ÿåˆ—" class="headerlink" title="3.3 é˜»å¡é˜Ÿåˆ—"></a>3.3 é˜»å¡é˜Ÿåˆ—</h3><p>é˜»å¡é˜Ÿåˆ—ä¸»è¦ç”¨æ¥å­˜å‚¨å¤šä½™çš„ä»»åŠ¡ï¼Œå®ƒä¸çº¿ç¨‹æ± äº¤äº’çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<ol>
<li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡å°‘äº<code>corePoolSize</code>ï¼Œåˆ™Executorä¼šæ·»åŠ æ–°çº¿ç¨‹è€Œä¸æ˜¯å°†ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—</li>
<li>å¦‚æœæ­£åœ¨è¿è¡Œçš„çº¿ç¨‹æ•°é‡ä¸å°‘äº<code>corePoolSize</code>ï¼Œåˆ™Executorä¼šé€‰æ‹©å°†æ–°ä»»åŠ¡æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—è€Œä¸æ˜¯åˆ›å»ºæ–°çº¿ç¨‹</li>
<li>å¦‚æœé˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œé‚£ä¹ˆExecutorä¼šé€‰æ‹©åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ã€‚å¦‚æœæ€»çš„çº¿ç¨‹æ•°é‡å¤§äº<code>maximumPoolSize</code>ï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¼šæ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li>
</ol>
<p>å¯¹äºé˜»å¡é˜Ÿåˆ—å¦‚ä½•æ’é˜Ÿçš„é€»è¾‘ï¼Œå¯ä»¥ç»†åˆ†ä¸ºä¸‰ç§ï¼š</p>
<ol>
<li><p><strong>ç›´æ¥äº¤ä»˜</strong>ã€‚å¯¹äºå·¥ä½œé˜Ÿåˆ—ï¼Œä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤é€‰æ‹©æ˜¯SynchronousQueueï¼Œå®ƒå¯ä»¥å°†ä»»åŠ¡ç§»äº¤ç»™çº¿ç¨‹ï¼Œè€Œä¸å¿…å¦å¤–ä¿ç•™å®ƒä»¬ã€‚åœ¨è¿™é‡Œï¼Œå¦‚æœæ²¡æœ‰ç«‹å³å¯ç”¨çš„çº¿ç¨‹æ¥è¿è¡Œä»»åŠ¡ï¼Œåˆ™å°è¯•å°†å…¶æ’é˜Ÿçš„å°è¯•å°†å¤±è´¥ï¼Œå› æ­¤å°†æ„é€ ä¸€ä¸ªæ–°çº¿ç¨‹ã€‚åœ¨å¤„ç†å¯èƒ½å…·æœ‰å†…éƒ¨ä¾èµ–é¡¹çš„è¯·æ±‚é›†æ—¶ï¼Œæ­¤ç­–ç•¥é¿å…äº†é”å®šã€‚ç›´æ¥åˆ‡æ¢é€šå¸¸éœ€è¦æ— é™åˆ¶çš„maximumPoolSizesä»¥é¿å…æ‹’ç»æ–°æäº¤çš„ä»»åŠ¡ã€‚åè¿‡æ¥ï¼Œå½“å¹³å‡è€Œè¨€ï¼Œå‘½ä»¤ç»§ç»­ä»¥æ¯”å…¶å¯å¤„ç†çš„é€Ÿåº¦æ›´å¿«åˆ°è¾¾æ—¶ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥æ— é™çº¿ç¨‹å¢é•¿çš„å¯èƒ½æ€§ã€‚</p>
</li>
<li><p><strong>æ— ç•Œé˜Ÿåˆ—</strong>ã€‚ä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼ˆä¾‹å¦‚ï¼Œæ²¡æœ‰é¢„å®šä¹‰å®¹é‡çš„LinkedBlockingQueueï¼‰å°†åœ¨æ‰€æœ‰corePoolSizeçº¿ç¨‹ç¹å¿™æ—¶ä½¿æ–°ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚å› æ­¤ï¼Œå°†ä»…åˆ›å»ºcorePoolSizeçº¿ç¨‹ã€‚ ï¼ˆå› æ­¤ï¼ŒmaximumPoolSizeçš„å€¼æ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚ï¼‰å½“æ¯ä¸ªä»»åŠ¡å®Œå…¨ç‹¬ç«‹äºå…¶ä»–ä»»åŠ¡æ—¶ï¼Œè¿™å¯èƒ½æ˜¯é€‚å½“çš„ï¼Œå› æ­¤ä»»åŠ¡ä¸ä¼šå½±å“å½¼æ­¤çš„æ‰§è¡Œã€‚ä¾‹å¦‚ï¼Œåœ¨ç½‘é¡µæœåŠ¡å™¨ä¸­ã€‚å°½ç®¡è¿™ç§æ’é˜Ÿæ–¹å¼å¯¹äºæ¶ˆé™¤çŸ­æš‚çš„è¯·æ±‚çªå‘å¾ˆæœ‰ç”¨ï¼Œä½†å®ƒæ‰¿è®¤å½“å‘½ä»¤å¹³å‡ç»§ç»­ä»¥æ¯”å¤„ç†é€Ÿåº¦æ›´å¿«çš„é€Ÿåº¦åˆ°è¾¾æ—¶ï¼Œæ— é™åˆ¶çš„å·¥ä½œé˜Ÿåˆ—å¢é•¿æ˜¯å¯èƒ½çš„ã€‚</p>
</li>
<li><p><strong>æœ‰ç•Œé˜Ÿåˆ—</strong>ã€‚ä¸æœ‰é™çš„maximumPoolSizesä¸€èµ·ä½¿ç”¨æ—¶ï¼Œæœ‰ç•Œé˜Ÿåˆ—ï¼ˆä¾‹å¦‚ArrayBlockingQueueï¼‰æœ‰åŠ©äºé˜²æ­¢èµ„æºè€—å°½ï¼Œä½†è°ƒä¼˜å’Œæ§åˆ¶èµ·æ¥ä¼šæ›´åŠ å›°éš¾ã€‚é˜Ÿåˆ—å¤§å°å’Œæœ€å¤§æ± å¤§å°å¯èƒ½ä¼šç›¸äº’æŠ˜è¡·ï¼šä½¿ç”¨å¤§é˜Ÿåˆ—å’Œå°å®¹é‡çº¿ç¨‹æ± å¯ä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘CPUä½¿ç”¨ç‡ï¼Œæ“ä½œç³»ç»Ÿèµ„æºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œä½†ä¼šå¯¼è‡´äººä¸ºåœ°é™ä½ååé‡ã€‚å¦‚æœä»»åŠ¡é¢‘ç¹é˜»å¡ï¼ˆä¾‹å¦‚éƒ½æ˜¯I/Oæ“ä½œï¼‰ï¼Œåˆ™ç³»ç»Ÿåœ¨å®Œæˆä»»åŠ¡æ—¶å› ä¸ºé˜»å¡ä¼šèŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚ä½¿ç”¨å°é˜Ÿåˆ—å¤§å®¹é‡çº¿ç¨‹æ± ï¼ŒCPUé¢‘ç¹åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ä¹Ÿæ˜¯ä¸å¯å¿½ç•¥çš„ï¼Œè¿™åŒæ ·ä¼šé™ä½ååé‡ã€‚</p>
</li>
</ol>
<h3 id="3-4-æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥"><a href="#3-4-æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥" class="headerlink" title="3.4 æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥"></a>3.4 æ‹’ç»ä»»åŠ¡çš„ç­–ç•¥</h3><p>çº¿ç¨‹æ± æ‹’ç»ä»»åŠ¡çš„æ—¶æœºæœ‰ä¸¤ç§ï¼š</p>
<ol>
<li>å½“çº¿ç¨‹æ± å…³é—­åï¼Œçº¿ç¨‹ä¼šæ‹’ç»æ‰§è¡Œæäº¤çš„ä»»åŠ¡</li>
<li>å½“çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°æœ€å¤§ï¼Œå¹¶ä¸”é˜»å¡é˜Ÿåˆ—ä¹Ÿæ²¡æœ‰ç©ºé—´çš„æ—¶å€™ï¼Œçº¿ç¨‹æ± ä¼šæ‹’ç»æ‰§è¡Œæäº¤çš„ä»»åŠ¡ã€‚</li>
</ol>
<p>æ‹’ç»çš„æ“ä½œç”±çº¿ç¨‹æ± ä¸­çš„<code>RejectedExecutionHandler</code>å±æ€§æ¥å®Œæˆã€‚é‚£ä¹ˆå…·ä½“çš„æ‹’ç»é€»è¾‘åˆå¯ä»¥åˆ†ä¸ºå››ç§ï¼š</p>
<ol>
<li><strong>ThreadPoolExecutor.AbortPolicy</strong>ï¼šè¿™æ˜¯çº¿ç¨‹æ± çš„<strong>é»˜è®¤</strong>æ‹’ç»ç­–ç•¥ã€‚è¯¥ç­–ç•¥åœ¨æ‹’ç»æ—¶ä¼šæŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸RejectedExecutionExceptionã€‚</li>
<li><strong>ThreadPoolExecutor.CallerRunsPolicy</strong>ï¼šè¯¥ç­–ç•¥å°±æ˜¯åœ¨çº¿ç¨‹æ± <strong>æœªå…³é—­æ—¶</strong>ç›´æ¥è°ƒç”¨<code>Runnable</code>å®ç°ç±»çš„<code>run</code>æ‰§è¡Œä»»åŠ¡ã€‚è¿™æä¾›äº†ä¸€ç§ç®€å•çš„åé¦ˆæ§åˆ¶æœºåˆ¶ï¼Œè¯¥æœºåˆ¶å°†å‡æ…¢æ–°ä»»åŠ¡çš„æäº¤é€Ÿåº¦ã€‚</li>
<li><strong>ThreadPoolExecutor.DiscardPolicy</strong>ï¼šç›´æ¥å¿½ç•¥å½“å‰æäº¤çš„ä»»åŠ¡</li>
<li><strong>ThreadPoolExecutor.DiscardOldestPolicy</strong>ï¼šå¦‚æœçº¿ç¨‹æ± æœªå…³é—­ï¼Œåˆ™ä¼šæŠ›å¼ƒé˜»å¡é˜Ÿåˆ—å¤´éƒ¨çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•è®©çº¿ç¨‹æ± æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼ˆè¯¥æ“ä½œå¯èƒ½å†æ¬¡å¤±è´¥ï¼Œå¯¼è‡´é‡å¤æ‰§è¡Œæ­¤æ“ä½œï¼‰ã€‚</li>
</ol>
<p>å½“ç„¶æˆ‘ä»¬è‡ªå·±ä¹Ÿå¯ä»¥å®ç°è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼Œä¸è¿‡éœ€è¦æ³¨æ„ï¼Œç­–ç•¥åªèƒ½åœ¨é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸€å®šçš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆã€‚</p>
<h3 id="3-5-å¯hookæ–¹æ³•"><a href="#3-5-å¯hookæ–¹æ³•" class="headerlink" title="3.5 å¯hookæ–¹æ³•"></a>3.5 å¯hookæ–¹æ³•</h3><p><code>ThreadPoolExecutor</code>å†…éƒ¨æä¾›äº†å¯ä»¥è¢«overrideçš„<code>beforeExecute(Thread,Runnable)</code>å’Œ<code>afterExecute(Runnable,Throwable)</code>ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•ä¼šåœ¨æ¯ä¸ªä»»åŠ¡æ‰§è¡Œå‰åè°ƒç”¨ã€‚è¿™ä¸¤ä¸ªhookå‡½æ•°å¯ä»¥ç”¨æ¥æ‰§è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œã€‚ ä¾‹å¦‚ï¼Œé‡æ–°åˆå§‹åŒ–ThreadLocalsï¼Œæ”¶é›†ç»Ÿè®¡ä¿¡æ¯æˆ–æ·»åŠ æ—¥å¿—ã€‚ å¦å¤–ï¼Œä¸€æ—¦æ‰§è¡Œç¨‹åºå®Œå…¨ç»ˆæ­¢ï¼Œå¯ä»¥ç»ˆæ­¢æ–¹æ³•ç»ˆæ­¢ä»¥æ‰§è¡Œéœ€è¦æ‰§è¡Œçš„ä»»ä½•ç‰¹æ®Šå¤„ç†ã€‚</p>
<p>å¹¶ä¸”<code>ThreadPoolExecutor</code>ä¹Ÿæä¾›äº†å¯è¢«overrideçš„<code>terminated()</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¸€èˆ¬ç”¨æ¥è¿›è¡Œä¸€äº›ç‰¹æ®Šæ“ä½œï¼ˆå½“ç„¶åªèƒ½ä¸€æ¬¡ï¼‰ï¼Œå½“Executorè¢«å®Œå…¨å…³é—­çš„æ—¶å€™ã€‚<br>å¦‚æœé’©å­æˆ–å›è°ƒæ–¹æ³•å¼•å‘å¼‚å¸¸ï¼Œå†…éƒ¨å·¥ä½œçº¿ç¨‹å¯èƒ½è¿›è€Œå¤±è´¥å¹¶çªç„¶ç»ˆæ­¢ã€‚</p>
<p><strong>å½“ç„¶å¦‚æœè¿™äº›hookå‡½æ•°å†…éƒ¨æŠ›å‡ºäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆå·¥ä½œçº¿ç¨‹å¯èƒ½ä¼šå‡ºç°ä¸å¯é¢„çŸ¥çš„é”™è¯¯ã€‚</strong></p>
<p>Queue maintenance<br>Method getQueue() allows access to the work queue for purposes of monitoring and debugging. Use of this method for any other purpose is strongly discouraged. Two supplied methods, remove(Runnable) and purge are available to assist in storage reclamation when large numbers of queued tasks become cancelled.</p>
<h3 id="3-6-çº¿ç¨‹æ± çš„å›æ”¶"><a href="#3-6-çº¿ç¨‹æ± çš„å›æ”¶" class="headerlink" title="3.6 çº¿ç¨‹æ± çš„å›æ”¶"></a>3.6 çº¿ç¨‹æ± çš„å›æ”¶</h3><p>å¦‚æœä¸€ä¸ªçº¿ç¨‹æ± æ²¡æœ‰è¢«å¼•ç”¨ï¼Œå¹¶ä¸”æ± å†…<strong>æ²¡æœ‰å­˜æ´»çº¿ç¨‹</strong>çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¼šè‡ªåŠ¨å…³é—­ã€‚é‚£ä¹ˆå¦‚ä½•ä¿è¯åœ¨ä¸ä½¿ç”¨çº¿ç¨‹æ± çš„æƒ…å†µä¸‹ï¼Œæ± å†…æ²¡æœ‰å­˜æ´»çº¿ç¨‹æ‰æ˜¯å…³é”®ã€‚é‚£ä¹ˆè¿™ä¸ªé—®é¢˜æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li>ä¸è®¾ç½®çº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œé‚£ä¹ˆå¯¹äºä¸´æ—¶ç”³è¯·çš„å·¥ä½œçº¿ç¨‹ä¼šè‡ªåŠ¨å…³é—­ã€‚</li>
<li>è°ƒç”¨<code>allowCoreThreadTimeOut(boolean)</code>ï¼Œå…è®¸æ ¸å¿ƒçº¿ç¨‹å­˜åœ¨è¿‡æœŸæœºåˆ¶</li>
</ol>
<h2 id="4-ç³»ç»Ÿæä¾›çš„çº¿ç¨‹æ± "><a href="#4-ç³»ç»Ÿæä¾›çš„çº¿ç¨‹æ± " class="headerlink" title="4. ç³»ç»Ÿæä¾›çš„çº¿ç¨‹æ± "></a>4. ç³»ç»Ÿæä¾›çš„çº¿ç¨‹æ± </h2><p>å¯ä»¥çœ‹åˆ°ï¼Œå‰æ–‡æåˆ°çº¿ç¨‹æ± çš„å‚æ•°æ˜¯å¤šæ ·åŒ–çš„ï¼Œé‚£ä¹ˆä¸ºäº†é€‚ç”¨äºä¸åŒçš„ç”Ÿäº§ç¯å¢ƒï¼ŒJUCæä¾›äº†ä¸€ä¸ª<code>Executor</code>å·¥å‚ï¼š<code>Exexutors</code>ç±»ï¼Œè¿™ä¸ªç±»é€šè¿‡é¢„å®šä¹‰ä¸åŒçš„å‚æ•°ç”Ÿäº§ä¸€äº›é€‚ç”¨äºä¸åŒåœºæ™¯çš„çº¿ç¨‹æ± ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li><code>Executors.newCachedThreadPool</code>ï¼šæ— é™åˆ¶çº¿ç¨‹æ± ï¼Œå¹¶ä¸”å¯ä»¥è‡ªåŠ¨å›æ”¶</li>
<li><code>Executors.newFixedThreadPool</code>ï¼šçº¿ç¨‹æ•°é‡å›ºå®š</li>
<li><code>Executors.newSingleThreadExecutor</code>ï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„çº¿ç¨‹æ± </li>
</ol>
<h2 id="5-å°ç»“"><a href="#5-å°ç»“" class="headerlink" title="5. å°ç»“"></a>5. å°ç»“</h2><p>æœ¬ç¯‡ç®€è¦å™è¿°äº†JUCä¸­çš„Executoræ¡†æ¶ï¼Œä»¥åŠä¸¤ä¸ªæ ¸å¿ƒæ¥å£<code>Executor</code>ã€<code>ExecutorService</code>ã€‚å¹¶ä¸”ç®€å•ä»‹ç»äº†çº¿ç¨‹æ± å®ç°ç±»<code>ThreadPoolExecutor</code>çš„ä¸€éƒ¨åˆ†é…ç½®å‚æ•°ä»¥åŠä¸€äº›å†…ç½®çš„çº¿ç¨‹æ± ã€‚åç»­æˆ‘ä»¬å°±éœ€è¦è¯¦ç»†ç ”ç©¶<code>ThreadPoolExecutor</code>åˆ°åº•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/java%E5%9F%BA%E7%A1%80/">javaåŸºç¡€</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Executor/">Executor</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/articles/interface-BlockingQueue-analysis.html">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">BlockingQueueæ¥å£åˆ†æ</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/articles/ThreadPoolExecutor.html">
                        <span class="hidden-mobile">ThreadPoolExecutorçº¿ç¨‹æ± è§£æ</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="waline"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#waline', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/@waline/client@0.16.2/dist/Waline.min.js', function() {
        var options = Object.assign(
          {"serverURL":"https://blog-comment-blond.vercel.app","placeholder":"è¯´ç‚¹ä»€ä¹ˆ","path":"window.location.pathname","avatar":"retro","meta":["nick","mail","link"],"pageSize":10,"lang":"zh-CN","highlight":true,"avatarCDN":"","avatarForce":false,"requiredFields":[],"emojiCDN":null,"emojiMaps":null,"anonymous":null},
          {
            el: '#waline',
            path: window.location.pathname
          }
        )
        new Waline(options);
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud ç»Ÿè®¡PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            æ€»è®¿é—®é‡ 
            <span id="leancloud-site-pv"></span>
             æ¬¡
          </span>
      
      
        <!-- LeanCloud ç»Ÿè®¡UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            æ€»è®¿å®¢æ•° 
            <span id="leancloud-site-uv"></span>
             äºº
          </span>
      

    
  </div>


  

  

  <div>
    <span id="timeDate">è½½å…¥å¤©æ•°...</span>
    <span id="times">è½½å…¥æ—¶åˆ†ç§’...</span>
    <script>
    var now = new Date();
    function createtime(){
        var grt= new Date("06/03/2021 00:00:00");//æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´æˆ–è€…ç½‘ç«™ä¸Šçº¿æ—¶é—´
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24;
        dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
        hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){
            hnum = "0" + hnum;
        }
        minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes);
        if(String(mnum).length ==1 ){
                  mnum = "0" + mnum;
        }
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds);
        if(String(snum).length ==1 ){
                  snum = "0" + snum;
        }
        document.getElementById("timeDate").innerHTML = "ğŸš€ for&nbsp"+dnum+"&nbspdays";  //æ­¤æ¬¡è‡ªå®šä¹‰æ˜¾ç¤ºå†…å®¹
        document.getElementById("times").innerHTML = hnum + "&nbsphr&nbsp" + mnum + "&nbspmin&nbsp" + snum + "&nbspsec";
    }  //æ­¤æ¬¡è‡ªå®šä¹‰æ˜¾ç¤ºå†…å®¹
    setInterval("createtime()",250);
    </script>
  </div>
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>












  

  
    <!-- Google Analytics -->
    <script defer>
      window.ga = window.ga || function () { (ga.q = ga.q || []).push(arguments) };
      ga.l = +new Date;
      ga('create', 'UA-198559201-1', 'auto');
      ga('send', 'pageview');
    </script>
    <script async src='https://www.google-analytics.com/analytics.js'></script>
  

  
    <!-- Google gtag.js -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-19MVRDT9NM"></script>
    <script defer>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-19MVRDT9NM');
    </script>
  

  

  

  





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ ä¿æŒåœ¨æœ€åº•éƒ¨ -->
<script  src="/js/boot.js" ></script>


</body>
</html>
